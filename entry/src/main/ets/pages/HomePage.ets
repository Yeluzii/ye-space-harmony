import { User } from "../module/user"
import { Font } from "@kit.ArkUI"

@Preview
@Component
export struct HomePage {
  @State
  date: Date = new Date()
  @State time: string = ''
  private timer: number = -1
  @StorageLink('user')
  user: User | undefined = AppStorage.get('user')
  font: Font = new Font()

  // ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼šç»„ä»¶å‡ºç°æ—¶å¯åŠ¨å®šæ—¶å™¨
  aboutToAppear() {
    // åˆå§‹åŒ–æ—¶é—´
    this.updateTime()
    // å¯åŠ¨å®šæ—¶å™¨ï¼Œæ¯ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´
    this.timer = setInterval(() => {
      this.updateTime()
    }, 1000)
    // æ³¨å†Œå­—ä½“
    this.font.registerFont({
      familyName: 'TanukiMagic',
      familySrc: $rawfile('fonts/TanukiMagicéº¦å…‹ç¬”æ‰‹ç»˜.ttf')
    })
  }

  // ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼šç»„ä»¶æ¶ˆå¤±æ—¶æ¸…é™¤å®šæ—¶å™¨
  aboutToDisappear() {
    if (this.timer !== -1) {
      clearInterval(this.timer)
      this.timer = -1
    }
  }

  // æ›´æ–°æ—¶é—´çš„æ–¹æ³•
  private updateTime() {
    this.date = new Date()
    // æ ¼å¼åŒ–æ—¶é—´ï¼Œåªä¿ç•™æ—¶åˆ†ç§’éƒ¨åˆ†
    this.time = this.date.toTimeString().split(' ')[0]
  }

  build() {
    Column({ space: 5 }) {
      Column({ space: 10 }) {
        Text("ç°åœ¨æ˜¯")
          .fontSize(50)
          .width('100%')
        Text(this.date.getFullYear() + ' å¹´')
          .fontSize(24)
          .width('100%')
        Text(this.date.getMonth()+1 + ' æœˆ')
          .fontSize(30)
          .width('100%')
        Text(this.date.getDate() + ' æ—¥')
          .fontSize(35)
          .width('100%')
        Text("æ˜ŸæœŸ" + ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][this.date.getDay()])
          .fontSize(40)
          .width('100%')
        Text(this.time)
          .fontFamily('TanukiMagic')
          .fontSize(50)
        Text(this.user?.slogan ? "ğŸ’•" + this.user?.slogan : "ğŸ’•ğŸ’•ğŸ’•")
          .fontFamily('TanukiMagic,HarmonyHeiTi-Medium')
          .fontSize(16)
          .maxLines(1)
          .textOverflow({
            overflow: TextOverflow.Ellipsis
          })
          .ellipsisMode(EllipsisMode.END)
      }
      .padding("20vp")
      .border({
        radius: 16,
        width: 1,
        color: Color.Black,
      })
      .shadow({
        radius: 5,
        offsetX: 5,
        offsetY: 5,
        color: Color.Gray
      })
      .margin({
        top: '5vp'
      })
      .width('90%')
    }
    .width('100%')
    .height('100%')
  }
}